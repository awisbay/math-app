generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  name          String
  birthDate     DateTime? @map("birth_date")
  currentGrade  Int       @map("current_grade")
  firebaseUid   String?   @unique @map("firebase_uid")
  
  // Relations
  sessions      Session[]
  progress      Progress?
  streak        Streak?
  
  // Timestamps
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@map("users")
}

model Session {
  id              String          @id @default(uuid())
  userId          String          @map("user_id")
  grade           Int
  score           Int
  totalQuestions  Int             @map("total_questions")
  correctAnswers  Int             @map("correct_answers")
  timeSpent       Int             @map("time_spent") // in seconds
  completedAt     DateTime?       @map("completed_at")
  expiresAt       DateTime        @map("expires_at")
  
  // Relations
  user            User            @relation(fields: [userId], references: [id])
  answers         SessionAnswer[]
  
  createdAt       DateTime        @default(now()) @map("created_at")

  @@map("sessions")
}

model SessionAnswer {
  id            String    @id @default(uuid())
  sessionId     String    @map("session_id")
  questionId    String    @map("question_id")
  selectedOption Int      @map("selected_option")
  isCorrect     Boolean   @map("is_correct")
  timeSpent     Int       @map("time_spent") // in seconds
  
  // Relations
  session       Session   @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime  @default(now()) @map("created_at")

  @@map("session_answers")
}

model Streak {
  id              String    @id @default(uuid())
  userId          String    @unique @map("user_id")
  current         Int       @default(0)
  longest         Int       @default(0)
  lastCompletedAt DateTime? @map("last_completed_at")
  
  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  updatedAt       DateTime  @updatedAt @map("updated_at")

  @@map("streaks")
}

model Progress {
  id              String    @id @default(uuid())
  userId          String    @unique @map("user_id")
  totalSessions   Int       @default(0) @map("total_sessions")
  totalQuestions  Int       @default(0) @map("total_questions")
  correctAnswers  Int       @default(0) @map("correct_answers")
  totalTimeSpent  Int       @default(0) @map("total_time_spent")
  
  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  updatedAt       DateTime  @updatedAt @map("updated_at")

  @@map("progress")
}

model Question {
  id            String    @id @default(uuid())
  grade         Int
  topic         String
  type          String    // multiple_choice, fill_in_blank
  question      String
  options       String[]  // JSON array for multiple choice
  correctAnswer Int       @map("correct_answer") // index of correct option
  difficulty    Int       @default(1) // 1-3
  
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@map("questions")
  @@index([grade])
  @@index([topic])
}
